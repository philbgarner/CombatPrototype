!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("canvas")):"function"==typeof define&&define.amd?define(["canvas"],e):"object"==typeof exports?exports.imui=e(require("canvas")):t.imui=e(t.canvas)}(self,(t=>(()=>{"use strict";var e={517:e=>{e.exports=t}},i={};function s(t){var h=i[t];if(void 0!==h)return h.exports;var r=i[t]={exports:{}};return e[t](r,r.exports,s),r.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var h={};return(()=>{s.r(h),s.d(h,{BezierBlend:()=>m,ImUI:()=>w,updateDelay:()=>g}),s(517);const t=class{constructor(t){if(!t.id)throw new Error("Element must have unique id.");this.id=t.id,this.autosize=!t.autosize||t.autosize,t.rect&&(this.autosize=!1),this.rect=t.rect?t.rect:{x:0,y:0,w:0,h:0},this.color=t.color?t.color:"#ccccccff",this.bgcolor=t.bgcolor?t.bgcolor:void 0,this.text=t.text?t.text:"",this.prevText=this.text,this.anim=t.anim?t.anim:null,this.wrap=t.wrap?t.wrap:"",this.font=t.font?t.font:imui.font,this.rect.x=t.x?t.x:this.rect.x,this.rect.y=t.y?t.y:this.rect.y,this.state={clicked:!1,mouseOver:!1,mouseDown:!1,mouseUp:!1,change:!0},this.prevState=t.prevState?t.prevState:{clicked:!1,mouseOver:!1,mouseDown:!1,mouseUp:!1,change:!1}}DidChangeState(){return this.prevState.clicked!==this.state.clicked||this.prevState.mouseOver!==this.state.mouseOver||this.prevState.mouseDown!==this.state.mouseDown||this.prevState.mouseUp!==this.state.mouseUp||this.prevState.change!==this.state.change}BuildPreviousState(){return{clicked:this.state.clicked,mouseOver:this.state.mouseOver,mouseDown:this.state.mouseDown,mouseUp:this.state.mouseUp,change:this.state.change}}InsideRect(t,e,i){let s=i||this.Rect();return t>=s.x&&t<s.x+s.w&&e>=s.y&&e<s.y+s.h}Clicked(){return this.state.clicked}Hover(){return this.state.mouseOver}MouseDown(){return this.state.mouseDown}MouseUp(){return this.state.mouseUp}setState(t){this.prevState=this.BuildPreviousState();for(let e in t)this.state[e]=t[e]}Rect(){let t={x:this.rect.x,y:this.rect.y,w:this.rect.w,h:this.rect.h};return this.parent&&(t.x+=this.parent.Rect().x,t.y+=this.parent.Rect().y),t}Update(t,e){let i=!1;if(this.anim){if("bezier"===this.anim.curve){this.anim.elapsed=void 0===this.anim.elapsed?0:this.anim.elapsed;for(let t in this.anim.params){let e=this.anim.params[t];this.anim.destination=this.anim.destination?this.anim.destination:{},"x"!==t&&"y"!==t&&"w"!==t&&"h"!==t||(this.anim.destination[t]=void 0!==this.anim.destination[t]?this.anim.destination[t]:this.rect[t],this.anim.destination[t]>e?this.rect[t]=parseInt(e+(this.anim.destination[t]-e)*m(this.anim.elapsed/this.anim.duration)):this.rect[t]=parseInt(e-(e-this.anim.destination[t])*m(this.anim.elapsed/this.anim.duration)))}if(this.anim.elapsed+=g,this.anim.elapsed>=this.anim.duration){for(let t in this.anim.params)"x"!==t&&"y"!==t&&"w"!==t&&"h"!==t||(this.rect[t]=this.anim.destination[t]);this.anim.onComplete&&this.anim.onComplete(this),this.anim=null}}}else this.state.clicked&&this.id!==t.active&&(t.active=this.id,this.setState({changed:!0}),i=!0),t.mousePos.x>=this.Rect().x&&t.mousePos.y>=this.Rect().y&&t.mousePos.x<=this.Rect().x+this.Rect().w&&t.mousePos.y<=this.Rect().y+this.Rect().h?(this.state.mouseOver&&this.state.clicked?(this.setState({mouseOver:!0,clicked:!1}),i=!0):e||(this.setState({mouseOver:!0}),i=!0),t.mouseButton>0&&!this.state.mouseDown?(this.setState({mouseDown:!0,mouseButton:t.mouseButton}),i=!0):0===t.mouseButton&&this.prevState.mouseDown&&(this.setState({mouseUp:!0,mouseDown:!1}),i=!0)):this.setState({mouseOver:!1,mouseDown:!1,mouseUp:!1,clicked:!1}),0===t.mouseButton&&this.state.mouseUp&&(this.setState({mouseUp:!1,clicked:!0}),t.active=this.id,i=!0),this.text!==this.prevText?(this.setState({change:!0}),this.prevText=this.text):this.setState({change:!1});return i}GetMaxTextWidth(t,e){let i=[];try{"number"==typeof e&&(e=t.codepage.filter((t=>t.codenumber===e))[0].symbol),i=e.split("\n")}catch(t){console.log("Error splitting txt parameters: ",t," typeof txt =",typeof e)}let s=0;for(let e in i){let h=i[e],r=0;for(let e in h){let i=t.codepage.filter((t=>t.symbol===h[e]));i.length>0&&i[0].rect&&(r+=i[0].rect.w)}r>s&&(s=r)}return s}GetWrappedText(t,e,i){let s=e.split("\n"),h=parseInt(i.w/t.cwidth),r=0;for(;this.GetMaxTextWidth(t,s.join("\n"))>=i.w&&r<=100;){let e=[];for(let r in s)s[r].length*t.cwidth>i.w?e.push(s[r].slice(0,h).trim(),s[r].slice(h,s[r].length).trim()):e.push(s[r]);s=e,r++}return s.join("\n")}GetWordWrappedText(t,e,i){let s=e.split("\n"),h=parseInt(i.w/t.cwidth),r=0;for(;this.GetMaxTextWidth(t,s.join("\n"))>=i.w&&r<=100;){let e=[];for(let r in s)if(s[r].length*t.cwidth>i.w){let t=s[r].substring(0,h).split("").reverse().join("").search(/\s/);e.push(s[r].slice(0,h-t).trim(),s[r].slice(h-t,s[r].length).trim())}else e.push(s[r]);s=e,r++}return s.join("\n")}DoTextWrap(t){let e=this.text?this.text:"";if(t=t||bfontjs.Fonts().default,this.GetMaxTextWidth(t,e)>this.Rect().w)if("clip"===this.wrap){let i=Math.floor(this.Rect().w/t.cwidth);e=e.substring(0,i)}else if("ellipses"===this.wrap){let i=Math.floor(this.Rect().w/t.cwidth);e=e.substring(0,i-3),e+="..."}else"wrap"===this.wrap?e=this.GetWrappedText(t,e,this.Rect()):"word-wrap"===this.wrap&&(e=this.GetWordWrappedText(t,e,this.Rect()));e="string"==typeof e?e:"";let i=this.GetMaxTextWidth(t,e),s=e.split("\n").length*t.cheight;return{text:e,w:i>this.Rect().w?i:this.Rect().w,h:s>this.Rect().h?s:this.Rect().h}}DrawText(t,e,i){let s=this.color;this.id===t.active&&(s=this.highlight?this.highlight:s);let h=this.DoTextWrap(e);t.DrawTextFont(e,i.x,i.y,h.text,s),i.h=h.h,i.w=h.w}_Draw(t,e){this.bgcolor&&t.DrawRect(e,this.bgcolor);let i=this.font?this.font:t.font;this.DrawText(t,i,e)}Draw(t){let e=t.ctx;e.save(),this.parent&&(e.beginPath(),e.rect(this.parent.Rect().x,this.parent.Rect().y,this.parent.Rect().w,this.parent.Rect().h),e.closePath(),e.clip()),this._Draw(t,this.Rect()),e.restore()}Animate(t,e,i,s){this.anim={curve:"bezier",duration:t,params:e,onComplete:s||(()=>{})},this.rect=i}},e=class extends t{constructor(t){super(t),this.rect.h=16*parseInt(this.rect.h/16),this.rect.w=9*parseInt(this.rect.w/9),t.drawBuffer&&this.InitializeBuffer({x:9,y:32})}_Draw(t,e){this.bgcolor&&t.DrawRect(e,this.bgcolor);let i=this.text.length>(e.w-2)/t.font.cwidth?this.text.substr(0,parseInt((e.w-2)/t.font.cwidth)):this.text,s={x:e.x+t.font.cwidth/2,y:e.y+t.font.cheight/2,w:e.w-t.font.cwidth,h:e.h-t.font.cheight};t.StrokeRect(s,this.color),t.DrawText(e.x+t.font.cwidth,e.y+t.font.cheight,i,this.color)}},i=class extends t{constructor(t){super(t),this.rect.h=16*parseInt(this.rect.h/16),this.rect.w=9*parseInt(this.rect.w/9),t.drawBuffer&&this.InitializeBuffer({x:9,y:32})}_Draw(t,e){this.bgcolor&&t.DrawRect(e,this.bgcolor);let i=this.text.length>(e.w-2)/t.font.cwidth?this.text.substr(0,parseInt((e.w-2)/t.font.cwidth)):this.text,s={x:e.x+t.font.cwidth/2,y:e.y+t.font.cheight/2,w:e.w-t.font.cwidth,h:e.h-t.font.cheight},h=this.inverted?this.shadow:this.highlight,r=this.inverted?this.highlight:this.shadow;t.StrokeLine(s.x,s.y,s.x+s.w,s.y,h),t.StrokeLine(s.x+s.w,s.y,s.x+s.w,s.y+s.h,h),t.StrokeLine(s.x,s.y+s.h,s.x+s.w,s.y+s.h,r),t.StrokeLine(s.x,s.y,s.x,s.y+s.h,r),t.DrawText(e.x+t.font.cwidth,e.y+t.font.cheight,i,this.color)}},r=class extends t{constructor(t){super(t),this.rect.h=16*parseInt(this.rect.h/16),this.rect.w=9*parseInt(this.rect.w/9),t.drawBuffer&&this.InitializeBuffer({x:9,y:32})}_Draw(t,e){this.bgcolor&&t.DrawRect(e,this.bgcolor);let i=this.text.length>(e.w-2)/t.font.cwidth?this.text.substr(0,parseInt((e.w-2)/t.font.cwidth)):this.text,s={x:e.x+t.font.cwidth/2,y:e.y+t.font.cheight/2,w:e.w-t.font.cwidth,h:e.h-t.font.cheight},h=!!this.inverted&&this.inverted;this.state.mouseDown&&(h=!0);let r=h?this.shadow:this.highlight,n=h?this.highlight:this.shadow;t.StrokeLine(s.x,s.y,s.x+s.w,s.y,r),t.StrokeLine(s.x+s.w,s.y,s.x+s.w,s.y+s.h,r),t.StrokeLine(s.x,s.y+s.h,s.x+s.w,s.y+s.h,n),t.StrokeLine(s.x,s.y,s.x,s.y+s.h,n);let c=0,o=0;this.state.mouseDown&&(c=parseInt(.3*t.font.cwidth),o=parseInt(.1*t.font.cheight)),t.DrawText(s.x+c+s.w/2-i.length*t.font.cwidth/2,s.y+o+s.h/2-t.font.cheight/2,i,this.color)}},n=class extends t{constructor(t){super(t),this.rect.h=16*parseInt(this.rect.h/16),this.rect.w=9*parseInt(this.rect.w/9),this.leftChar=t.leftChar?t.leftChar:"<",this.rightChar=t.rightChar?t.rightChar:">",t.drawBuffer&&this.InitializeBuffer({x:9,y:32})}_Draw(t,e){let i=this.text.length>(e.w-2)/t.font.cwidth?this.text.substr(0,parseInt((e.w-2)/t.font.cwidth)):this.text,s=this.color,h=this.bgcolor;this.state.mouseOver&&!this.state.mouseDown&&this.highlight&&(s=this.highlight),h&&(this.state.mouseDown&&(s=this.bgcolor,h=this.color),t.DrawRect(e,h)),this.id===t.active&&(s=this.highlight?this.highlight:s),t.DrawText(e.x+e.w/2-i.length*t.font.cwidth/2,e.y+e.h/2-t.font.cheight/2,i,s),t.DrawText(e.x,e.y+e.h/2-t.font.cheight/2,this.leftChar,s),t.DrawText(e.x+e.w-t.font.cwidth,e.y+e.h/2-t.font.cheight/2,this.rightChar,s)}},c=class extends t{constructor(t){super(t),this.text=t.defaultText?t.defaultText:"",this.font=t.font?t.font:null,this.font?(this.rect.h=parseInt(this.rect.h/this.font.cheight*this.font.cheight),this.rect.w=this.GetMaxTextWidth(this.font,this.text)):(this.rect.w=8,this.rect.h=8),this.editable=!t.editable||t.editable,t.drawBuffer&&this.InitializeBuffer({x:9,y:32})}Text(){return this.text}_Draw(t,e){this.font||(this.font=t.font);let i=this.text,s=this.color,h=this.bgcolor;this.state.mouseOver&&!this.state.mouseDown&&this.highlight&&(s=this.highlight),h&&(this.state.mouseDown&&(s=this.bgcolor,h=this.color),t.DrawRect(e,h)),this.id===t.active&&(s=this.highlight?this.highlight:s,Date.now()%1e3>500&&t.DrawTextFont(this.font,e.x+this.GetMaxTextWidth(this.font,`${i}`),e.y+e.h/2-this.font.cheight/2,"_",s)),t.DrawTextFont(this.font,e.x,e.y+e.h/2-this.font.cheight/2,i,s)}},o=class extends t{constructor(t){super(t),this.bgScrollbar=t.bgScrollbar?t.bgScrollbar:"#645355ff",this.list=t.list?t.list:[],this.currentItem=null,this.scrollOffset=t.scrollOffset?t.scrollOffset:0,this.topDown=!t.topDown||t.topDown,this.horizontal=!!t.horizontal&&t.horizontal,this.scrollbar=!t.scrollbar||t.scrollbar,this.scrollbarCharacters={scrollUp:t.scrollUp?t.scrollUp:252,scrollDown:t.scrollDown?t.scrollDown:253,scrollCaret:t.scrollCaret?t.scrollCaret:254},this.draggingCaret=!1}_Draw(t,e){let i=this.color,s=this.bgcolor;this.state.mouseOver&&!this.state.mouseDown&&this.highlight&&(i=this.highlight),s&&t.DrawRect(e,s);let h=e.x+t.font.cwidth,r=e.y;for(let s=this.scrollOffset;s<this.list.length;s++){let n=this.list[s],c={x:h,y:r,w:n.length*t.font.cwidth,h:t.font.cheight},o=this.state.mouseOver&&t.mousePos.y>=c.y&&t.mousePos.x>=c.x&&t.mousePos.x<c.x+c.w&&t.mousePos.y<c.y+c.h,l=this.state.mouseDown&&t.mousePos.y>=c.y&&t.mousePos.x>=c.x&&t.mousePos.x<c.x+c.w&&t.mousePos.y<c.y+c.h;if(l&&(this.currentItem=s),t.DrawText(h,r,n,o?i:this.color,o||this.currentItem===s?{background:{colour:l?"#ccccccff":this.bgScrollbar}}:void 0),this.horizontal?h+=t.font.cwidth*(n.length+1):r+=t.font.cheight,h>e.x+e.w)break;if(r+t.font.cheight>e.y+e.h)break}if(this.Rect().h<t.font.cheight*this.list.length&&!this.horizontal){let i={x:e.x+e.w-t.font.cwidth,y:e.y,w:t.font.cwidth,h:t.font.cheight},s={x:e.x+e.w-t.font.cwidth,y:e.y+e.h-t.font.cheight,w:t.font.cwidth,h:t.font.cheight},h={x:e.x+e.w-t.font.cwidth,y:e.y+t.font.cheight,w:t.font.cwidth,h:e.h-2*t.font.cheight};t.DrawRect(h,this.bgScrollbar),t.DrawText(i.x,i.y,this.scrollbarCharacters.scrollUp,this.InsideRect(t.mousePos.x,t.mousePos.y,i)&&this.state.mouseDown?this.highlight:this.color,this.InsideRect(t.mousePos.x,t.mousePos.y,i)&&this.state.mouseDown?{background:{colour:this.color}}:{background:{colour:this.bgScrollbar}}),t.DrawText(s.x,s.y,this.scrollbarCharacters.scrollDown,this.InsideRect(t.mousePos.x,t.mousePos.y,s)&&this.state.mouseDown?this.highlight:this.color,this.InsideRect(t.mousePos.x,t.mousePos.y,s)&&this.state.mouseDown?{background:{colour:this.color}}:{background:{colour:this.bgScrollbar}});let r=this.scrollOffset/(this.list.length-1)*h.h,n=this.color,c=this.bgScrollbar;this.draggingCaret?this.draggingCaret&&this.state.mouseDown?(this.scrollOffset=parseInt((t.mousePos.y-h.y)/h.h*(this.list.length-2)),this.scrollOffset<0?this.scrollOffset=0:this.scrollOffset>this.list.length-1&&(this.scrollOffset=this.list.length-1),c=this.color,n=this.bgScrollbar):this.draggingCaret&&(this.draggingCaret=!1):this.InsideRect(t.mousePos.x,t.mousePos.y,i)&&this.Clicked()?null!==this.scrollOffset&&(this.scrollOffset=this.scrollOffset-1<0?0:this.scrollOffset-1):this.InsideRect(t.mousePos.x,t.mousePos.y,s)&&this.Clicked()?null!==this.scrollOffset&&(this.scrollOffset=this.scrollOffset+1>this.list.length-1?this.list.length-1:this.scrollOffset+1):this.InsideRect(t.mousePos.x,t.mousePos.y,{x:h.x,y:h.y+r,w:h.w,h:t.font.cwidth})&&this.state.mouseDown?this.draggingCaret=!0:this.InsideRect(t.mousePos.x,t.mousePos.y,h)&&this.Clicked()&&null!==this.scrollOffset&&(t.mousePos.y<h.y+r?this.scrollOffset=this.scrollOffset-10>0?this.scrollOffset-10:0:t.mousePos.y>h.y+r+t.font.cheight&&(this.scrollOffset=this.scrollOffset+10<this.list.length-1?this.scrollOffset+10:this.list.length-1));let o=this.InsideRect(t.mousePos.x,t.mousePos.y,{x:h.x,y:h.y+r,w:h.w,h:t.font.cwidth});t.DrawText(h.x,h.y+r,this.scrollbarCharacters.scrollCaret,o?this.highlight:n,{background:{colour:c}})}}},l=class extends t{constructor(t){super(t),this.image=t.image?t.image:null,this.rect.w&&this.rect.h||(this.rect.h=this.image.height,this.rect.w=this.image.width)}_Draw(t,e){this.image&&("IMG"===this.image.tagName?t.ctx.drawImage(this.image,this.Rect().x,this.Rect().y,this.Rect().w,this.Rect().h):this.image.draw&&this.image.draw())}},a=class extends t{constructor(t){super(t),this.image=t.image?t.image:null,t.innerRect?this.innerRect=t.innerRect:t.borderWidth?this.innerRect={x:t.borderWidth,y:t.borderWidth,w:this.rect.w-2*t.borderWidth,h:this.rect.h-2*t.borderWidth}:this.innerRect={x:0,y:0,w:this.rect.w,h:this.rect.h}}_Draw(t,e){if(this.bgcolor&&t.DrawRect(e,this.bgcolor),this.image){t.ctx.drawImage(this.image,0,0,this.innerRect.x,this.innerRect.y,this.rect.x,this.rect.y,this.innerRect.x,this.innerRect.y),t.ctx.drawImage(this.image,this.image.width-this.innerRect.x,0,this.innerRect.x,this.innerRect.y,this.rect.x+this.rect.w-this.innerRect.x,this.rect.y,this.innerRect.x,this.innerRect.y),t.ctx.drawImage(this.image,0,this.image.height-this.innerRect.y,this.innerRect.x,this.innerRect.y,this.rect.x,this.rect.y+this.rect.h-this.innerRect.y,this.innerRect.x,this.innerRect.y),t.ctx.drawImage(this.image,this.image.width-this.innerRect.x,this.image.height-this.innerRect.y,this.innerRect.x,this.innerRect.y,this.rect.x+this.rect.w-this.innerRect.x,this.rect.y+this.rect.h-this.innerRect.y,this.innerRect.x,this.innerRect.y);for(let e=this.rect.x+this.innerRect.x;e<this.rect.x+this.rect.w-this.innerRect.x;e+=this.image.width-2*this.innerRect.x){let i=this.image.width-2*this.innerRect.x;e+i>this.rect.x+this.rect.w-this.innerRect.x&&(i=this.rect.x+this.rect.w-this.innerRect.x-e),t.ctx.drawImage(this.image,this.innerRect.x,0,i,this.innerRect.y,e,this.rect.y,i,this.innerRect.y)}for(let e=this.rect.x+this.innerRect.x;e<this.rect.x+this.rect.w-this.innerRect.x;e+=this.image.width-2*this.innerRect.x){let i=this.image.width-2*this.innerRect.x;e+i>this.rect.x+this.rect.w-this.innerRect.x&&(i=this.rect.x+this.rect.w-this.innerRect.x-e),t.ctx.drawImage(this.image,this.innerRect.x,this.image.height-this.innerRect.y,i,this.innerRect.y,e,this.rect.y+this.rect.h-this.innerRect.y,i,this.innerRect.y)}for(let e=this.rect.y+this.innerRect.y;e<this.rect.y+this.rect.h-this.innerRect.y;e+=this.image.height-2*this.innerRect.y){let i=this.image.height-2*this.innerRect.y;e+i>this.rect.y+this.rect.h-this.innerRect.y&&(i=this.rect.y+this.rect.h-this.innerRect.y-e),t.ctx.drawImage(this.image,0,this.innerRect.y,this.innerRect.x,i,this.rect.x,e,this.innerRect.x,i)}for(let e=this.rect.y+this.innerRect.y;e<this.rect.y+this.rect.h-this.innerRect.y;e+=this.image.height-2*this.innerRect.y){let i=this.image.height-2*this.innerRect.y;e+i>this.rect.y+this.rect.h-this.innerRect.y&&(i=this.rect.y+this.rect.h-this.innerRect.y-e),t.ctx.drawImage(this.image,this.image.width-this.innerRect.x,this.innerRect.y,this.innerRect.x,i,this.rect.x+this.rect.w-this.innerRect.x,e,this.innerRect.x,i)}let e=this.innerRect.x,i=this.innerRect.y,s=this.image.width-2*this.innerRect.x,h=this.image.height-2*this.innerRect.y,r=this.innerRect.x+this.rect.x,n=this.innerRect.y+this.rect.y;for(;n<this.rect.y+this.rect.h-this.innerRect.y;){let c=s,o=h;r+c>this.rect.x+this.rect.w-this.innerRect.x&&(c=this.rect.x+this.rect.w-this.innerRect.x-r),n+o>this.rect.y+this.rect.h-this.innerRect.y&&(o=this.rect.y+this.rect.h-this.innerRect.y-n),t.ctx.drawImage(this.image,e,i,c,o,r,n,c,o),r+=s,r>this.rect.x+this.rect.w-this.innerRect.x&&(r=this.innerRect.x+this.rect.x,n+=h)}}let i=this.text.length>(e.w-2)/t.font.cwidth?this.text.substr(0,parseInt((e.w-2)/t.font.cwidth)):this.text;t.DrawText(e.x+this.innerRect.x,e.y+this.innerRect.y,i,this.color)}},x=class extends t{constructor(t){super(t),this.image=t.image?t.image:null,this.imageDown=t.imageDown?t.imageDown:null,this.imageHover=t.imageHover?t.imageHover:null,this.pressedOffsetY=t.pressedOffsetY?t.pressedOffsetY:2,t.innerRect?this.innerRect=t.innerRect:t.borderWidth?this.innerRect={x:t.borderWidth,y:t.borderWidth,w:this.Rect().w-2*t.borderWidth,h:this.Rect().h-2*t.borderWidth}:this.innerRect={x:0,y:0,w:this.Rect().w,h:this.Rect().h}}drawImageSlice(t,e){if(e){t.ctx.drawImage(e,0,0,this.innerRect.x,this.innerRect.y,this.Rect().x,this.Rect().y,this.innerRect.x,this.innerRect.y);let i=e.width-(this.innerRect.x+this.innerRect.w);t.ctx.drawImage(e,e.width-i,0,i,this.innerRect.y,this.Rect().x+this.Rect().w-i,this.Rect().y,i,this.innerRect.y);let s=e.height-(this.innerRect.y+this.innerRect.h);t.ctx.drawImage(e,e.width-i,e.height-s,i,s,this.Rect().x+this.Rect().w-i,this.Rect().y+this.Rect().h-s,i,s),t.ctx.drawImage(e,0,e.height-s,this.innerRect.x,s,this.Rect().x,this.Rect().y+this.Rect().h-s,this.innerRect.x,s);for(let s=this.Rect().x+this.innerRect.x;s<this.Rect().x+this.Rect().w-i;s+=this.innerRect.w){let h=e.width-i;s+h>this.Rect().x+this.Rect().w-i&&(h=this.Rect().x+this.Rect().w-i-s),t.ctx.drawImage(e,this.innerRect.x,0,h,this.innerRect.y,s,this.Rect().y,h,this.innerRect.y)}for(let h=this.Rect().x+this.innerRect.x;h<this.Rect().x+this.Rect().w-i;h+=this.innerRect.w){let r=e.width-i;h+r>this.Rect().x+this.Rect().w-i&&(r=this.Rect().x+this.Rect().w-i-h),t.ctx.drawImage(e,this.innerRect.x,e.height-s,r,s,h,this.Rect().y+this.Rect().h-s,r,s)}for(let i=this.Rect().y+this.innerRect.y;i<this.Rect().y+this.Rect().h-s;i+=this.innerRect.h){let h=e.height-s;i+h>this.Rect().y+this.Rect().h-s&&(h=this.Rect().y+this.Rect().h-s-i),t.ctx.drawImage(e,0,this.innerRect.y,this.innerRect.x,h,this.Rect().x,i,this.innerRect.x,h)}for(let h=this.Rect().y+this.innerRect.y;h<this.Rect().y+this.Rect().h-s;h+=this.innerRect.h){let r=e.height-s;h+r>this.Rect().y+this.Rect().h-s&&(r=this.Rect().y+this.Rect().h-s-h),t.ctx.drawImage(e,e.width-i,this.innerRect.y,i,r,this.Rect().x+this.Rect().w-i,h,i,r)}let h=this.innerRect.x,r=this.innerRect.y,n=this.innerRect.w,c=this.innerRect.h,o=this.innerRect.x+this.Rect().x,l=this.innerRect.y+this.Rect().y;for(;l<this.Rect().y+this.Rect().h-s;){let a=n,x=c;o+a>this.Rect().x+this.Rect().w-i&&(a=this.Rect().x+this.Rect().w-i-o),l+x>this.Rect().y+this.Rect().h-s&&(x=this.Rect().y+this.Rect().h-s-l),t.ctx.drawImage(e,h,r,a,x,o,l,a,x),o+=n,o>this.Rect().x+this.Rect().w-i&&(o=this.innerRect.x+this.Rect().x,l+=c)}}}_Draw(t,e){let i=this.state.mouseDown?this.pressedOffsetY:0,s=this.Hover()?this.highlight:this.color;this.Hover()&&!this.state.mouseDown&&this.imageHover?this.drawImageSlice(t,this.imageHover):this.state.mouseDown&&this.imageDown?this.drawImageSlice(t,this.imageDown):this.drawImageSlice(t,this.image);let h=this.text.length>(e.w-2)/t.font.cwidth?this.text.substr(0,parseInt((e.w-2)/t.font.cwidth)):this.text;t.DrawText(e.x+e.w/2-h.length*t.font.cwidth/2,e.y+e.h/2-t.font.cheight/2+i,h,s)}},d=class extends t{constructor(t){super(t),this.list=t.list?t.list:[],this.currentItem=null,this.selectedList=[],this.scrollOffset=t.scrollOffset?t.scrollOffset:0,this.topDown=!t.topDown||t.topDown,this.horizontal=!!t.horizontal&&t.horizontal,this.scrollbar=!t.scrollbar||t.scrollbar,this.multiSelect=!!t.multiSelect&&t.multiSelect,this.bgcolorSelected=t.bgcolorSelected?t.bgcolorSelected:"#f1f1f1ff",this.colorSelected=t.colorSelected?t.colorSelected:"#090909ff",this.scrollbarWidth=t.scrollbarWidth?t.scrollbarWidth:8,this.checkboxImage=t.checkboxImage?t.checkboxImage:{image:null,hover:null,pressed:null,innerRect:null},this.caratImage=t.caratImage?t.caratImage:{image:null,hover:null,pressed:null,innerRect:null},this.upImage=t.upImage?t.upImage:{image:null,hover:null,pressed:null,innerRect:null},this.downImage=t.downImage?t.downImage:{image:null,hover:null,pressed:null,innerRect:null},this.scrollAreaImage=t.scrollAreaImage?t.scrollAreaImage:{image:null,hover:null,pressed:null,innerRect:null},this.draggingCaret=!1,t.innerRect?this.innerRect=t.innerRect:t.borderWidth?this.innerRect={x:t.borderWidth,y:t.borderWidth+this.scrollbarWidth,w:this.Rect().w-this.scrollbarWidth,h:this.Rect().h-2*this.scrollbarWidth}:this.innerRect={x:0,y:0,w:this.Rect().w,h:this.Rect().h}}drawImageSlice(t,e,i,s){if(e){t.ctx.drawImage(e,0,0,s.x,s.y,i.x,i.y,s.x,s.y);let h=e.width-(s.x+s.w);t.ctx.drawImage(e,e.width-h,0,h,s.y,i.x+i.w-h,i.y,h,s.y);let r=e.height-(s.y+s.h);t.ctx.drawImage(e,e.width-h,e.height-r,h,r,i.x+i.w-h,i.y+i.h-r,h,r),t.ctx.drawImage(e,0,e.height-r,s.x,r,i.x,i.y+i.h-r,s.x,r);for(let r=i.x+s.x;r<i.x+i.w-h;r+=s.w){let n=e.width-h;r+n>i.x+i.w-h&&(n=i.x+i.w-h-r),t.ctx.drawImage(e,s.x,0,n,s.y,r,i.y,n,s.y)}for(let n=i.x+s.x;n<i.x+i.w-h;n+=s.w){let c=e.width-h;n+c>i.x+i.w-h&&(c=i.x+i.w-h-n),t.ctx.drawImage(e,s.x,e.height-r,c,r,n,i.y+i.h-r,c,r)}for(let h=i.y+s.y;h<i.y+i.h-r;h+=s.h){let n=e.height-r;h+n>i.y+i.h-r&&(n=i.y+i.h-r-h),t.ctx.drawImage(e,0,s.y,s.x,n,i.x,h,s.x,n)}for(let n=i.y+s.y;n<i.y+i.h-r;n+=s.h){let c=e.height-r;n+c>i.y+i.h-r&&(c=i.y+i.h-r-n),t.ctx.drawImage(e,e.width-h,s.y,h,c,i.x+i.w-h,n,h,c)}let n=s.x,c=s.y,o=s.w,l=s.h,a=s.x+i.x,x=s.y+i.y;for(;x<i.y+i.h-r;){let d=o,g=l;a+d>i.x+i.w-h&&(d=i.x+i.w-h-a),x+g>i.y+i.h-r&&(g=i.y+i.h-r-x),t.ctx.drawImage(e,n,c,d,g,a,x,d,g),a+=o,a>i.x+i.w-h&&(a=s.x+i.x,x+=l)}}}_Draw(t){let e=this.Rect(),i=this.color,s=this.bgcolor;this.state.mouseOver&&!this.state.mouseDown&&this.highlight&&(i=this.highlight),s&&t.DrawRect(e,s);let h=e.x+t.font.cwidth,r=e.y,n=this.multiSelect?9:0;this.hoverItem=null;for(let c=this.scrollOffset;c<this.list.length;c++){let o=this.list[c],l={x:h,y:r,w:this.GetMaxTextWidth(t.font,o)+1+n,h:t.font.cheight},a=this.state.mouseOver&&t.mousePos.y>=l.y&&t.mousePos.x>=l.x&&t.mousePos.x<l.x+l.w&&t.mousePos.y<l.y+l.h,x=t.mousePos.y>=l.y&&t.mousePos.x>=l.x&&t.mousePos.x<l.x+l.w&&t.mousePos.y<l.y+l.h;if(a&&(this.hoverItem=c),this.state.mouseDown&&x&&this.currentItem!==c){if(this.multiSelect){let t=this.selectedList.findIndex((t=>t===c));t>=0?(this.selectedList=this.selectedList.filter(((e,i)=>i!==t)),this.currentItem=null):this.selectedList.push(c)}else this.selectedList=[c];this.currentItem=c}else this.state.mouseUp&&x&&this.currentItem===c&&console.log(this.state.clicked,this.state,this.prevState.clicked,this.prevState);if(t.DrawRect(l,this.selectedList.includes(c)?this.bgcolorSelected:s),t.DrawText(n+h+1,r+1,o,a?i:this.selectedList.includes(c)?this.colorSelected:this.color),this.multiSelect&&this.checkboxImage.image&&t.ctx.drawImage(this.selectedList.includes(c)?this.checkboxImage.pressed:this.checkboxImage.image,h,r),this.horizontal?h+=t.font.cwidth*(o.length+1):r+=t.font.cheight,h>e.x+e.w)break;if(r+t.font.cheight>e.y+e.h)break}if(e.h<t.font.cheight*this.list.length&&!this.horizontal){let i={x:e.x+e.w-this.scrollbarWidth,y:e.y,w:this.scrollbarWidth,h:this.scrollbarWidth},s={x:e.x+e.w-this.scrollbarWidth,y:e.y+e.h-this.scrollbarWidth,w:this.scrollbarWidth,h:this.scrollbarWidth},h={x:e.x+e.w-this.scrollbarWidth,y:e.y+this.scrollbarWidth,w:this.scrollbarWidth,h:e.h-2*this.scrollbarWidth},r=parseInt(this.scrollOffset/(this.list.length-1)*(h.h-this.scrollbarWidth)),n={x:h.x,y:h.y+r,w:h.w,h:this.scrollbarWidth};this.scrollAreaImage.image?this.drawImageSlice(t,this.scrollAreaImage.image,{x:i.x,y:i.y,w:h.w,h:i.h+s.h+h.h},this.scrollAreaImage.innerRect):t.DrawRect(h,"#c0c0c0ff");let c=this.InsideRect(t.mousePos.x,t.mousePos.y,s);this.downImage.image?t.ctx.drawImage(this.downImage.hover&&c?this.state.mouseDown?this.downImage.pressed:this.downImage.hover:this.downImage.image,s.x,s.y):t.DrawRect(s,"#f1f1f1ff");let o=this.InsideRect(t.mousePos.x,t.mousePos.y,i);this.upImage.image?t.ctx.drawImage(this.upImage.hover&&o?this.state.mouseDown?this.upImage.pressed:this.upImage.hover:this.upImage.image,i.x,i.y):t.DrawRect(i,"#f1f1f1ff");let l=this.InsideRect(t.mousePos.x,t.mousePos.y,n);this.caratImage.image?t.ctx.drawImage(this.caratImage.hover&&l?this.state.mouseDown?this.caratImage.pressed:this.caratImage.hover:this.caratImage.image,n.x,n.y):t.DrawRect(n,l?"#f1f1c1ff":"#e1e1e1ff");let a=this.color,x=this.bgScrollbar;this.draggingCaret?this.draggingCaret&&this.state.mouseDown?(this.scrollOffset=parseInt((t.mousePos.y-h.y)/(h.h-i.h)*(this.list.length-1)),this.scrollOffset<0?this.scrollOffset=0:this.scrollOffset>this.list.length-1&&(this.scrollOffset=this.list.length-1),x=this.color,a=this.bgScrollbar):this.draggingCaret&&(this.draggingCaret=!1):this.InsideRect(t.mousePos.x,t.mousePos.y,i)&&this.Clicked()?null!==this.scrollOffset&&(this.scrollOffset=this.scrollOffset-1<0?0:this.scrollOffset-1):this.InsideRect(t.mousePos.x,t.mousePos.y,s)&&this.Clicked()?null!==this.scrollOffset&&(this.scrollOffset=this.scrollOffset+1>this.list.length-1?this.list.length-1:this.scrollOffset+1):this.InsideRect(t.mousePos.x,t.mousePos.y,n)&&this.state.mouseDown?this.draggingCaret=!0:this.InsideRect(t.mousePos.x,t.mousePos.y,h)&&this.Clicked()&&null!==this.scrollOffset&&(t.mousePos.y<h.y+r?this.scrollOffset=this.scrollOffset-10>0?this.scrollOffset-10:0:t.mousePos.y>h.y+r+t.font.cheight&&(this.scrollOffset=this.scrollOffset+10<this.list.length-1?this.scrollOffset+10:this.list.length-1))}}};let g=8;function m(t){return t*t*(3-2*t)}class w{constructor(t,e){this.canvas=t,this.originalCanvas=t,this.ctx=t.getContext("2d"),this.originalCtx=this.ctx,bfontjs.LoadDefaultFonts(),this.font=e||bfontjs.Fonts("default"),this.lastRect=null,this.mousePos={x:0,y:0},this.mouseButton=0,this.active=null,this.elements=[],this.postUpdateIds=[],this.onUpdate=()=>[],this.canvas.addEventListener("mousemove",(e=>{this.executing&&(this.mousePos.x=parseInt((e.clientX-t.offsetLeft)*(this.canvas.width/parseInt(this.canvas.style.width))),this.mousePos.y=parseInt((e.clientY-t.offsetTop)*(this.canvas.height/parseInt(this.canvas.style.height))))})),this.canvas.addEventListener("mousedown",(t=>{this.executing&&(this.mouseButton=t.buttons)})),this.canvas.addEventListener("mouseup",(t=>{this.executing&&(this.mouseButton=0)})),window.addEventListener("keydown",(t=>{this.executing&&"Tab"===t.key&&t.preventDefault()})),window.addEventListener("keyup",(t=>{if(this.executing)if(this.active){let e=this.elements.filter((t=>void 0!==t)).filter((t=>t.id===this.active));if(e.length>0&&e[0].editable&&(1===t.key.length?(e[0].prevText=e[0].text,e[0].text+=t.key):"Backspace"===t.key?(e[0].prevText=e[0].text,e[0].text=e[0].text.substring(0,e[0].text.length-1)):"Enter"===t.key&&(this.active=null)),e.length>0&&"Tab"===t.key){let t=this.elements.findIndex((t=>t.id===this.active));t+1<this.elements.length?t++:t=0,this.active=this.elements[t].id}}else this.elements.length>0&&"Tab"===t.key&&(this.active=this.elements[0].id);return!1})),this.Enable()}Disable(){this.executing=!1}Enable(){this.executing=!0,this.UpdateThread()}UpdateThread(){try{if(this.executing){let t=this.elements.map((t=>t.id));this.postUpdateIds=[],this.elements=this.elements.filter((t=>void 0!==t)),this.onUpdate(this);for(let e in t)0===this.postUpdateIds.filter((i=>i===t[e])).length&&(this.elements[this.elements.findIndex((i=>void 0!==i&&i.id===t[e]))]=void 0);this.elements=this.elements.filter((t=>void 0!==t)),this.Update(),setTimeout((()=>this.UpdateThread()),g)}}catch(t){console.error(t)}}ChangeContext(t){this.canvas=t,this.ctx=t.getContext("2d")}ResetContext(){this.canvas=this.originalCanvas,this.ctx=this.originalCtx}RemoveElement(t){if(this.elements.findIndex((e=>e.id===t))>=0){let e=[];for(let i in this.elements){let s=this.elements[i];s.id!==t&&e.push(s)}this.elements=e}}RemoveElements(){this.elements=[]}ElementToTop(t){let e=this.elements.findIndex((e=>e.id===t));if(e>=0){let t=[];e-1>=0&&(t=this.elements.slice(0,e)),e+1<=this.elements.length-1&&t.push(...this.elements.slice(e+1)),t.push(this.elements[e]),this.elements=t}}GetMaxTextWidth(t){let e=this.font,i=[];try{"number"==typeof t&&(t=e.codepage.filter((e=>e.codenumber===t))[0].symbol),i=t.split("\n")}catch(e){console.log("Error splitting txt parameters: ",e," typeof txt =",typeof t)}let s=0;for(let t in i){let h=i[t];h.length*e.cwidth>s&&(s=h.length*e.cwidth)}return s}Element(s,h){s.type=s.type?s.type:"element";let g=this.elements.filter((t=>t.id===s.id));if(0===g.length){let g=new(function(s){switch(s.toLowerCase()){case"element":return t;case"frameflat":return e;case"frame3d":return i;case"button3d":return r;case"buttonflat":return n;case"textboxflat":return c;case"list":return o;case"image":return l;case"frameimage":return a;case"buttonimage":return x;case"listimage":return d}}(s.type))(s);return g.Update(this,!1),this.elements.push(g),this.postUpdateIds.push(s.id),this.lastRect=g.rect,h&&(g.parent=h),g}this.postUpdateIds.push(s.id);for(let t in s)"anim"!==t&&(g[0][t]=s[t]);return this.lastRect=g[0].rect,h&&!g[0].parent&&(g[0].parent=h),g[0]}DrawTextFont(t,e,i,s,h,r){if(void 0!==s&&""!==s)return bfontjs.DrawText(this.ctx,parseInt(e),parseInt(i),s,h,t,r)}DrawText(t,e,i,s,h){return this.DrawTextFont(this.font,t,e,i,s,h)}DrawRect(t,e){this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.w,t.h)}StrokeRect(t,e){this.ctx.lineWidth=1,this.ctx.strokeStyle=e,this.ctx.strokeRect(parseInt(t.x)+.5,parseInt(t.y)+.5,parseInt(t.w),parseInt(t.h))}StrokeLine(t,e,i,s,h){this.ctx.lineWidth=1,this.ctx.strokeStyle=h,this.ctx.beginPath(),this.ctx.moveTo(parseInt(t)+.5,parseInt(e)+.5),this.ctx.lineTo(parseInt(i)+.5,parseInt(s)+.5),this.ctx.stroke()}Update(){let t=!1;for(let e=this.elements.length-1;e>=0;e--)!t&&this.elements[e]&&(t=this.elements[e].Update(this,t))}Draw(){for(let t in this.elements)this.elements[t]&&this.elements[t].Draw(this)}}})(),h})()));
//# sourceMappingURL=bfont-imui.js.map